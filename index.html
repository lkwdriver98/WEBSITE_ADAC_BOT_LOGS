<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TechFlair Enterprise Dashboard</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background-color: #f4f6f9; color: #333; display: flex; min-height: 100vh; }
    nav.sidebar { width: 240px; background-color: #002b5c; color: #fff; display: flex; flex-direction: column; padding: 1rem; }
    nav.sidebar h2 { margin-bottom: 2rem; font-size: 1.4rem; text-align: center; }
    nav.sidebar a { color: #cfd8dc; text-decoration: none; padding: 0.75rem 1rem; border-radius: 4px; margin-bottom: 0.5rem; display: block; cursor: pointer; }
    nav.sidebar a.active, nav.sidebar a:hover { background-color: #0056a3; color: #fff; }
    main.content { flex: 1; padding: 2rem; overflow-y: auto; display: none; }
    header.topbar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
    header.topbar h1 { font-size: 1.75rem; color: #002b5c; }
    header.topbar .user-menu { display: flex; align-items: center; }
    header.topbar .user-menu span { font-weight: 500; color: #002b5c; }
    section.card { background-color: #fff; border-radius: 8px; padding: 1.5rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 2rem; }
    section.card h2 { font-size: 1.3rem; color: #004080; margin-bottom: 1rem; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.75rem 1rem; border-bottom: 1px solid #eceff1; text-align: left; }
    th { background-color: #e1f5fe; color: #004080; font-weight: 600; }
    tr:hover { background-color: #f1f8ff; }
    .status-badge { display: inline-block; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem; font-weight: 500; }
    .badge-user { background-color: #b2dfdb; color: #004d40; }
    .badge-admin { background-color: #ffe082; color: #ff6f00; }
    .modal { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .modal form { background: #fff; padding: 2rem; border-radius: 8px; width: 320px; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    .modal h2 { margin-bottom: 1rem; color: #002b5c; text-align: center; }
    .modal label { display: block; margin-top: 0.5rem; font-weight: 500; }
    .modal input, .modal select { width: 100%; padding: 0.5rem; margin-top: 0.25rem; border: 1px solid #ccc; border-radius: 4px; }
    .modal button { margin-top: 1rem; width: 100%; padding: 0.75rem; background-color: #0077b6; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; }
    .modal button:hover { background-color: #005fa3; }
    .error-msg { color: #d32f2f; margin-top: 0.5rem; font-size: 0.9rem; text-align: center; }
  </style>
</head>
<body>
  <!-- LOGIN MODAL -->
  <div id="loginModal" class="modal">
    <form id="loginForm">
      <h2>Login</h2>
      <label for="username">Benutzername</label>
      <input type="text" id="username" required>
      <label for="password">Passwort</label>
      <input type="password" id="password" required>
      <button type="submit">Einloggen</button>
      <div id="errorMsg" class="error-msg"></div>
      <p style="text-align:center;margin-top:1rem;"><a href="#" id="showRegister">Registrieren</a></p>
    </form>
  </div>

  <!-- REGISTER MODAL -->
  <div id="registerModal" class="modal" style="display:none;">
    <form id="registerForm">
      <h2>Registrierung</h2>
      <label for="regUsername">Benutzername</label>
      <input type="text" id="regUsername" required>
      <label for="regPassword">Passwort</label>
      <input type="password" id="regPassword" required>
      <label for="regRole">Rolle</label>
      <select id="regRole">
        <option value="user">User</option>
        <option value="admin">Admin</option>
      </select>
      <button type="submit">Registrieren</button>
      <div id="regMsg" class="error-msg"></div>
      <p style="text-align:center;margin-top:1rem;"><a href="#" id="showLogin">Zurück zum Login</a></p>
    </form>
  </div>

  <!-- SIDEBAR NAVIGATION -->
  <nav class="sidebar">
    <h2>TechFlair Inc.</h2>
    <a data-section="overview" class="active">Übersicht</a>
    <a data-section="logs">Logs</a>
    <a data-section="register" class="admin-only">Benutzer anlegen</a>
    <a data-section="users" class="admin-only">Benutzerverwaltung</a>
    <a data-section="settings" class="admin-only">Einstellungen</a>
  </nav>

  <!-- MAIN CONTENT -->
  <main class="content">
    <header class="topbar">
      <h1>ADAC-BOT Dashboard</h1>
      <div class="user-menu">
        <span id="userRole">User</span>
      </div>
    </header>

    <section id="overview" class="card">
      <h2>Wochenübersicht</h2>
      <div id="summary">Lade Daten...</div>
    </section>

    <section id="logs" class="card" style="display:none;">
      <h2>Gelöschte Nachrichten (Logs)</h2>
      <table>
        <thead>
          <tr><th>Timestamp</th><th>Hashed Content</th><th>Channel</th><th>Status</th></tr>
        </thead>
        <tbody id="logsTable">
          <tr><td colspan="4">Lade Logs...</td></tr>
        </tbody>
      </table>
    </section>

    <section id="register" class="card admin-only" style="display:none;">
      <h2>Neuen Benutzer anlegen</h2>
      <form id="regFormInline">
        <label for="regUsernameInline">Benutzername</label>
        <input type="text" id="regUsernameInline" required>
        <label for="regPasswordInline">Passwort</label>
        <input type="password" id="regPasswordInline" required>
        <label for="regRoleInline">Rolle</label>
        <select id="regRoleInline">
          <option value="user">User</option>
          <option value="admin">Admin</option>
        </select>
        <button type="submit">Registrieren</button>
        <div id="regMsgInline" class="error-msg"></div>
      </form>
    </section>

    <section id="users" class="card admin-only" style="display:none;">
      <h2>Benutzerverwaltung</h2>
      <table>
        <thead>
          <tr><th>ID</th><th>Username</th><th>Rolle</th><th>Aktionen</th></tr>
        </thead>
        <tbody id="usersTable">
          <tr><td colspan="4">Lade Benutzer...</td></tr>
        </tbody>
      </table>
    </section>

    <section id="settings" class="card admin-only" style="display:none;">
      <h2>Einstellungen</h2>
      <p>API-Key: <code>YOUR_API_KEY</code></p>
      <p>Reporting-Intervall: <code>7 Tage</code></p>
      <button onclick="alert('Einstellungen gespeichert')">Speichern</button>
    </section>
  </main>

  <script>
    const API_BASE = window.location.origin;
    const API_KEY = 'YOUR_API_KEY';
    let currentRole = null;

    const users = {
      'user': { password: 'userpass', role: 'user' },
      'admin': { password: 'adminpass', role: 'admin' },
      'ADMIN': { password: 'ADAC', role: 'admin' }
    };

    const loginModal = document.getElementById('loginModal');
    const registerModal = document.getElementById('registerModal');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const regFormInline = document.getElementById('regFormInline');

    document.getElementById('showRegister').addEventListener('click', e => {
      e.preventDefault(); loginModal.style.display='none'; registerModal.style.display='flex';
    });
    document.getElementById('showLogin').addEventListener('click', e => {
      e.preventDefault(); registerModal.style.display='none'; loginModal.style.display='flex';
    });

    loginForm.addEventListener('submit', e => {
      e.preventDefault();
      const u = document.getElementById('username').value;
      const p = document.getElementById('password').value;
      if (users[u] && users[u].password === p) {
        currentRole = users[u].role;
        loginModal.style.display = 'none';
        document.querySelector('main.content').style.display = 'block';
        document.getElementById('userRole').textContent = currentRole.charAt(0).toUpperCase() + currentRole.slice(1);
        document.querySelectorAll('.admin-only').forEach(el => el.style.display = currentRole === 'admin' ? 'block' : 'none');
        loadSummary(); loadLogs(); loadUsers();
      } else {
        document.getElementById('errorMsg').textContent = 'Ungültige Anmeldedaten';
      }
    });

    regFormInline.addEventListener('submit', async e => {
      e.preventDefault();
      const u = document.getElementById('regUsernameInline').value;
      const p = document.getElementById('regPasswordInline').value;
      const r = document.getElementById('regRoleInline').value;
      try {
        const res = await fetch(`${API_BASE}/users`, {
          method: 'POST',
          headers: { 'Content-Type':'application/json', 'Authorization': `Bearer ${API_KEY}` },
          body: JSON.stringify({ username: u, password: p, role: r })
        });
        if (!res.ok) throw new Error(`Status ${res.status}`);
        document.getElementById('regMsgInline').textContent = 'Benutzer angelegt.';
        loadUsers();
      } catch (err) {
        document.getElementById('regMsgInline').textContent = `Fehler: ${err.message}`;
      }
    });

    registerForm.addEventListener('submit', async e => {
      e.preventDefault();
      const u = document.getElementById('regUsername').value;
      const p = document.getElementById('regPassword').value;
      const r = document.getElementById('regRole').value;
      users[u] = { password: p, role: r };
      document.getElementById('regMsg').textContent = 'Registrierung erfolgreich.';
      setTimeout(() => {
        registerModal.style.display='none'; loginModal.style.display='flex'; document.getElementById('errorMsg').textContent = '';
      }, 1000);
    });

    document.querySelectorAll('nav.sidebar a').forEach(link => link.addEventListener('click', () => {
      document.querySelectorAll('nav.sidebar a').forEach(l => l.classList.remove('active'));
      link.classList.add('active');
      const sec = link.dataset.section;
      document.querySelectorAll('main.content section.card').forEach(s => s.id === sec ? s.style.display = 'block' : s.style.display = 'none');
    }));

    async function loadSummary() {
      try {
        const res = await fetch(`${API_BASE}/summary`, { headers: { 'Authorization': `Bearer ${API_KEY}` } });
        if (!res.ok) throw new Error(`Status ${res.status}`);
        const data = await res.json();
        document.getElementById('summary').textContent = `Gelöschte Nachrichten insgesamt: ${data.total_logs}`;
      } catch (e) {
        document.getElementById('summary').textContent = `Fehler: ${e.message}`;
      }
    }

    async function loadLogs() {
      const tb = document.getElementById('logsTable'); tb.innerHTML = '<tr><td colspan="4">Lade Logs...</td></tr>';
      try {
        const res = await fetch(`${API_BASE}/logs`, { headers: { 'Authorization': `Bearer ${API_KEY}` } });
        if (!res.ok) throw new Error(`Status ${res.status}`);
        const logs = await res.json();
        if (!Array.isArray(logs)) throw new Error('Unerwartetes Format');
        tb.innerHTML = logs.map(l => `<tr><td>${new Date(l.timestamp).toLocaleString()}</td><td>${l.content_hash}</td><td>${l.channel}</td><td><span class="status-badge badge-admin">gelöscht</span></td></tr>`).join('');
      } catch (e) {
        tb.innerHTML = `<tr><td colspan="4">Fehler beim Laden: ${e.message}`;
      }
    }

    async function loadUsers() {
      const tb = document.getElementById('usersTable'); tb.innerHTML = '<tr><td colspan="4">Lade Benutzer...</td></tr>';
      try {
        const res = await fetch(`${API_BASE}/users`, { headers: { 'Authorization': `Bearer ${API_KEY}` } });
        if (!res.ok) throw new Error(`Status ${res.status}`);
        const us = await res.json();
        if (!Array.isArray(us)) throw new Error('Unerwartetes Format');
        tb.innerHTML = us.map(u => `<tr><td>${u.id}</td><td>${u.username}</td><td><span class="status-badge badge-${u.role}">${u.role}</span></td><td><button onclick="alert('Aktion: '+u.username)">Aktionen</button></td></tr>`).join('');
      } catch (e) {
        tb.innerHTML = `<tr><td colspan="4">Fehler beim Laden: ${e.message}`;
      }
    }
  </script>
</body>
</html>
