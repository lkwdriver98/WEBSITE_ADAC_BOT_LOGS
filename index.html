<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ADAC-BOT Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f4f6f9; }
    nav { width: 230px; background: #002244; color: white; height: 100vh; position: fixed; padding: 20px; }
    nav h2 { margin-bottom: 20px; }
    nav a { display: block; color: #aab; margin: 10px 0; text-decoration: none; }
    nav a.active, nav a:hover { color: white; font-weight: bold; }
    main { margin-left: 230px; padding: 20px; }
    section { background: white; padding: 20px; border-radius: 6px; box-shadow: 0 0 5px #ccc; margin-bottom: 20px; }
    .hidden { display: none; }
    .error { color: red; }
    .api-status { float: right; color: red; font-size: 0.9em; }
  </style>
</head>
<body>

<!-- Sidebar -->
<nav>
  <h2>TechFlair Inc.</h2>
  <a href="#" onclick="showSection('overview')">Übersicht</a>
  <a href="#" onclick="showSection('logs')">Logs</a>
  <a href="#" onclick="showSection('users')">Benutzerverwaltung</a>
</nav>

<!-- Main content -->
<main>
  <h1>ADAC-BOT Dashboard <span id="apiStatus" class="api-status">❌ API nicht verbunden</span></h1>

  <section id="overview">
    <h2>Wochenübersicht</h2>
    <p id="summary">Diese Woche wurden 0 Nachrichten gelöscht (Demo).</p>
  </section>

  <section id="logs" class="hidden">
    <h2>Gelöschte Nachrichten (Logs)</h2>
    <p id="logsData">Lade...</p>
  </section>

  <section id="users" class="hidden">
    <h2>Benutzerverwaltung</h2>
    <p id="usersData">Lade...</p>
  </section>
</main>

<script>
const API_URL = "https://adac-bot-website-api.onrender.com";
const API_KEY = "1804";

// Navigation
function showSection(id) {
  document.querySelectorAll("section").forEach(s => s.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// Testverbindung & Logs laden
function loadLogs() {
  fetch(`${API_URL}/logs`, {
    headers: { "Authorization": API_KEY }
  })
  .then(res => {
    if (!res.ok) throw new Error("API Fehler");
    document.getElementById("apiStatus").textContent = "✅ API verbunden";
    document.getElementById("apiStatus").style.color = "green";
    return res.json();
  })
  .then(data => {
    const logs = data.logs || [];
    document.getElementById("logsData").innerHTML = logs.length === 0
      ? "<p>Keine gelöschten Nachrichten gefunden.</p>"
      : "<ul>" + logs.map(log =>
          `<li>[${log.time}] ${log.user} löschte "${log.message}"</li>`).join("") + "</ul>";
  })
  .catch(err => {
    document.getElementById("logsData").innerHTML = `<p class="error">Failed to fetch</p>`;
    console.error(err);
  });
}

// Benutzer laden
function loadUsers() {
  fetch(`${API_URL}/users`, {
    headers: { "Authorization": API_KEY }
  })
  .then(res => {
    if (!res.ok) throw new Error("API Fehler");
    return res.json();
  })
  .then(data => {
    const users = data.users || [];
    document.getElementById("usersData").innerHTML = users.length === 0
      ? "<p>Keine Benutzer gefunden.</p>"
      : "<ul>" + users.map(user =>
          `<li>${user.name} – Rolle: ${user.role}</li>`).join("") + "</ul>";
  })
  .catch(err => {
    document.getElementById("usersData").innerHTML = `<p class="error">Fehler: ${err.message}</p>`;
    console.error(err);
  });
}

// Initiale Aufrufe
loadLogs();
loadUsers();
</script>

</body>
</html>
